<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Missing Iterable Return Call in Pattern | Aran</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Missing Iterable Return Call in Pattern" />
<meta name="author" content="Laurent Christophe" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When the iterator protocol is involved in syntax constructs, the return method is called upon exiting the construct even in the case of an error. This is important because it provides an opportunity for the iterator to perform cleanup actions. However, after Aran instrumentation, if an error is thrown during array destructuring, the return method will not be called. This is currently not addressed because of three reasons:" />
<meta property="og:description" content="When the iterator protocol is involved in syntax constructs, the return method is called upon exiting the construct even in the case of an error. This is important because it provides an opportunity for the iterator to perform cleanup actions. However, after Aran instrumentation, if an error is thrown during array destructuring, the return method will not be called. This is currently not addressed because of three reasons:" />
<link rel="canonical" href="https://lachrist.github.io/aran/issues/missing-iterable-return-call-in-pattern" />
<meta property="og:url" content="https://lachrist.github.io/aran/issues/missing-iterable-return-call-in-pattern" />
<meta property="og:site_name" content="Aran" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-05-23T15:15:04+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Missing Iterable Return Call in Pattern" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Laurent Christophe"},"dateModified":"2025-05-23T15:15:04+02:00","datePublished":"2025-05-23T15:15:04+02:00","description":"When the iterator protocol is involved in syntax constructs, the return method is called upon exiting the construct even in the case of an error. This is important because it provides an opportunity for the iterator to perform cleanup actions. However, after Aran instrumentation, if an error is thrown during array destructuring, the return method will not be called. This is currently not addressed because of three reasons:","headline":"Missing Iterable Return Call in Pattern","mainEntityOfPage":{"@type":"WebPage","@id":"https://lachrist.github.io/aran/issues/missing-iterable-return-call-in-pattern"},"url":"https://lachrist.github.io/aran/issues/missing-iterable-return-call-in-pattern"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/aran/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://lachrist.github.io/aran/feed.xml" title="Aran" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/aran/">Aran</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/aran/start.html">Quick Start</a><a class="page-link" href="/aran/api.html">API</a><a class="page-link" href="/aran/typedoc.html">TypeDoc</a><a class="page-link" href="/aran/issues.html">Issues</a><a class="page-link" href="/aran/demo.html">Live Demo</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h1>Missing Iterable Return Call in Pattern</h1>
        <p>When the iterator protocol is involved in syntax constructs, the <code class="language-plaintext highlighter-rouge">return</code> method is called upon exiting the construct even in the case of an error. This is important because it provides an opportunity for the iterator to perform cleanup actions. However, after Aran instrumentation, if an error is thrown during array destructuring, the <code class="language-plaintext highlighter-rouge">return</code> method will not be called. This is currently not addressed because of three reasons:</p>

<ol>
  <li>It is a bit of a technical challenge to surround patterns with a <code class="language-plaintext highlighter-rouge">try</code> statement because they live in an expression context and not in a statement context.</li>
  <li>Surrounding every array destructuring with a <code class="language-plaintext highlighter-rouge">try</code> statement might cause a hard performance hit.</li>
  <li>I suspect iterators used in array destructuring are less in need of cleanup operations in practice.</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="dl">"</span><span class="s2">boum</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">})(),</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="kc">undefined</span> <span class="p">}),</span>
    <span class="na">return</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">cleanup</span><span class="dl">"</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="kc">undefined</span> <span class="p">};</span>
    <span class="p">},</span>
  <span class="p">}),</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Normal output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cleanup
Uncaught 'boum'
</code></pre></div></div>

<p>Aran output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Uncaught 'boum'
</code></pre></div></div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/aran/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Aran</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Laurent Christophe</li><li><a class="u-email" href="mailto:laurent.christophe.terken@gmail.com">laurent.christophe.terken@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/lachrist"><svg class="svg-icon"><use xlink:href="/aran/assets/minima-social-icons.svg#github"></use></svg> <span class="username">lachrist</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Documentation for Aran, a JavaScript Instrumentation Library</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
